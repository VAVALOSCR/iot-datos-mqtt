<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Robot Serial Simulator PRO</title>

<style>

/* ====== GENERAL ====== */

body{
    font-family: Arial;
    background:linear-gradient(#0f2027,#203a43,#2c5364);
    text-align:center;
    color:white;
}

h1{
    margin-top:10px;
}

/* ====== ROBOT ====== */

#zona{
    width:800px;
    margin:auto;
    padding:20px;
}

#robot{
    width:500px;
    height:220px;
    background:#222;
    margin:auto;
    border-radius:20px;
    border:4px solid #00ffcc;
    position:relative;
    box-shadow:0 0 20px #00ffcc;

    transition:0.3s;
}

/* Cabeza */
#head{
    width:120px;
    height:60px;
    background:#111;
    position:absolute;
    top:-70px;
    left:190px;
    border-radius:15px;
    border:2px solid cyan;
}

.eye{
    width:12px;
    height:12px;
    background:red;
    border-radius:50%;
    position:absolute;
    top:22px;
}

#eye1{ left:30px; }
#eye2{ right:30px; }

/* ====== RUEDAS ====== */

.wheel{
    width:70px;
    height:70px;
    background:#444;
    border-radius:50%;
    border:5px solid #999;
    position:absolute;
    top:140px;

    display:flex;
    justify-content:center;
    align-items:center;
}

.wheel::after{
    content:"";
    width:10px;
    height:50px;
    background:white;
}

#leftWheel{ left:-35px; }
#rightWheel{ right:-35px; }

/* Animaci√≥n ruedas */
.spin{
    animation:giro 0.5s linear infinite;
}

@keyframes giro{
    from{ transform:rotate(0deg); }
    to{ transform:rotate(360deg); }
}

/* ====== LEDS ====== */

.led{
    width:20px;
    height:20px;
    background:gray;
    border-radius:50%;
    display:inline-block;
    margin:5px;
}

.on{
    background:lime;
    box-shadow:0 0 10px lime;
}

/* ====== CAJAS ====== */

.box{
    background:#111;
    border:1px solid cyan;
    border-radius:10px;
    margin:10px;
    padding:10px;
}

input{
    width:50px;
    text-align:center;
}

button{
    padding:8px 14px;
    background:#00ffcc;
    border:none;
    border-radius:5px;
    cursor:pointer;
    font-weight:bold;
}

button:hover{
    background:#00ccaa;
}

/* ====== MOVIMIENTO ====== */

.forward{
    transform:translateY(-10px);
}

.back{
    transform:translateY(10px);
}

.left{
    transform:rotate(-6deg);
}

.right{
    transform:rotate(6deg);
}

.stop{
    transform:none;
}

</style>
</head>

<body>

<h1>ü§ñ SIMULADOR ROBOT SERIAL PRO</h1>

<div id="zona">

<!-- ROBOT -->

<div id="robot">

<div id="head">
    <div id="eye1" class="eye"></div>
    <div id="eye2" class="eye"></div>
</div>

<div id="leftWheel" class="wheel"></div>
<div id="rightWheel" class="wheel"></div>

</div>

</div>

<!-- LEDS -->

<div class="box">

<h3>LEDs Motores</h3>

Motor A:
<span id="A1" class="led"></span>
<span id="A2" class="led"></span>

&nbsp;&nbsp;

Motor B:
<span id="B1" class="led"></span>
<span id="B2" class="led"></span>

</div>

<!-- ENTRADAS -->

<div class="box">

<h3>Entradas</h3>

A: <input id="eA">
B: <input id="eB">

<button onclick="simular()">Simular</button>

</div>

<!-- CARACTERES -->

<div class="box">

<h3>Comandos</h3>

F <input id="cA" value="F">
B <input id="cB" value="B">
R <input id="cR" value="R">
L <input id="cL" value="L">
S <input id="cS" value="S">

</div>

<!-- SERIAL -->

<div class="box">

<h3>Serial</h3>

<button onclick="conectar()">üîå Conectar</button>
<span id="estado">No conectado</span>

</div>

<!-- CONTROL -->

<div class="box">

<h3>Control</h3>

<button onclick="cmd('A')">‚¨Ü Adelante</button>
<button onclick="cmd('B')">‚¨á Atr√°s</button>
<button onclick="cmd('R')">‚û° Derecha</button>
<button onclick="cmd('L')">‚¨Ö Izquierda</button>
<button onclick="cmd('S')">‚èπ STOP</button>

</div>

<p id="msg"></p>

<script>

/* ===== SERIAL ===== */

let port;
let writer;
let conectado=false;

async function conectar(){

    try{

        port = await navigator.serial.requestPort();
        await port.open({ baudRate:9600 });

        writer = port.writable.getWriter();

        conectado=true;
        estado.innerText="Conectado";

    }catch(e){

        alert("Error conexi√≥n");

    }
}

async function enviarSerial(txt){

    if(!conectado) return;

    const data = new TextEncoder().encode(txt);
    await writer.write(data);
}

/* ===== LED ===== */

function led(id,val){
    document.getElementById(id)
    .classList.toggle("on",val=="1");
}

/* ===== ROBOT ===== */

function mover(tipo){

    let r=document.getElementById("robot");
    let w1=document.getElementById("leftWheel");
    let w2=document.getElementById("rightWheel");

    r.className="";
    w1.className="wheel";
    w2.className="wheel";

    if(tipo!="stop"){
        w1.classList.add("spin");
        w2.classList.add("spin");
    }

    r.classList.add(tipo);
}

/* ===== APLICAR ===== */

function aplicar(a,b){

    led("A1",a[0]);
    led("A2",a[1]);

    led("B1",b[0]);
    led("B2",b[1]);

    let t="";

    if(a=="10"&&b=="10"){
        t="ADELANTE";
        mover("forward");
    }

    else if(a=="01"&&b=="01"){
        t="ATR√ÅS";
        mover("back");
    }

    else if(a=="10"&&b=="00"){
        t="DERECHA";
        mover("right");
    }

    else if(a=="00"&&b=="10"){
        t="IZQUIERDA";
        mover("left");
    }

    else{
        t="STOP";
        mover("stop");
    }

    msg.innerText=t;
}

/* ===== SIMULAR ===== */

function simular(){

    let a=eA.value;
    let b=eB.value;

    if(!["00","01","10"].includes(a)
    || !["00","01","10"].includes(b)){
        alert("Use: 00, 01 o 10");
        return;
    }

    aplicar(a,b);
}

/* ===== COMANDOS ===== */

async function cmd(c){

    let a="",b="",letra="";

    if(c=="A"){ a="10"; b="10"; letra=cA.value; }
    if(c=="B"){ a="01"; b="01"; letra=cB.value; }
    if(c=="R"){ a="10"; b="00"; letra=cR.value; }
    if(c=="L"){ a="00"; b="10"; letra=cL.value; }
    if(c=="S"){ a="00"; b="00"; letra=cS.value; }

    eA.value=a;
    eB.value=b;

    aplicar(a,b);

    await enviarSerial(letra);

    msg.innerText+=" | "+(conectado?"Enviado":"Sin serial");
}

</script>

</body>
</html>
